<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.kapture.mypage.mapper.MyPageMapper">
	<select id="selectUser" parameterType="hashmap" resultType="com.example.kapture.login.model.Login">
		SELECT USER_NO, PASSWORD, EMAIL, PHONE, ROLE, TO_CHAR(BIRTHDAY, 'YYYY-MM-DD') AS BIRTHDAY, ADDRESS, GENDER, U_CREATED_AT, U_UPDATED_AT, USER_FIRSTNAME, USER_LASTNAME, SOCIAL_TYPE, ISFOREIGNER, PUSHYN
		FROM USERS
		WHERE USER_NO = #{sessionId}
	</select>
	
	<update id="userInfoUpdate" parameterType="hashmap">
		UPDATE USERS
	    SET PHONE = #{phone},
	    	PUSHYN = #{pushYN},
	    	GENDER = #{gender}
	    WHERE USER_NO = #{sessionId}
	</update>
	<select id="selectPayList" parameterType="hashmap" resultType="com.example.kapture.mypage.model.Payments">
		SELECT P.*, TITLE, DURATION, TOUR_DATE
		FROM PAYMENTS P
		INNER JOIN TOURS T ON P.TOUR_NO = T.TOUR_NO
		WHERE USER_NO = #{sessionId}
	</select>
	
	
	
	
	<insert id="insertTour" parameterType="hashmap">
		INSERT INTO TOURS (TOUR_NO, GUIDE_NO, TITLE, PRICE, DELETEYN, SI_NO, GU_NO)
		SELECT TOUR_SEQ.NEXTVAL, G.GUIDE_NO, #{title}, #{price}, 'N', R.SI_NO, R.GU_NO
		FROM GUIDES G
		JOIN REGION R ON R.SI_NAME = #{siName} AND R.GU_NAME = #{guName}
		WHERE G.USER_NO = #{sessionId}
	</insert>
	
	
</mapper>




