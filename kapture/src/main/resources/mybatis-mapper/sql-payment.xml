<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.kapture.payment.mapper.PaymentMapper">
	<select id="selectPaymentList" parameterType="hashmap" resultType="com.example.kapture.payment.model.Payment">
		SELECT *
	    FROM BASKET B
	    JOIN TOURS T ON B.TOUR_NO = T.TOUR_NO
	    WHERE B.BASKET_NO IN 
	    <foreach item="no" collection="list" open="(" separator="," close=")">
	        #{no}
	    </foreach>
	</select>
	<insert id="insertPayment" parameterType="map">
	    INSERT INTO PAYMENTS (PAYMENT_NO, USER_NO, AMOUNT, METHOD, MERCHANT_ID, PAYMENT_STATUS, TOUR_NO, PAYMENT_DATE, NUM_PEOPLE, BASKET_NO) 
		VALUES (PAYMENT_SEQ.NEXTVAL, #{userNo}, #{amount}, #{method}, #{merchantId}, 'PAID', #{tourNo}, SYSDATE, #{numPeople}, #{basketNo})
	</insert>
	<select id="selectPayment" resultType="com.example.kapture.payment.model.Payment">
	    SELECT P.PAYMENT_NO, P.USER_NO, P.TOUR_NO, P.AMOUNT, P.PAYMENT_DATE, P.METHOD, P.NUM_PEOPLE, P.BASKET_NO,T.TITLE, T.PRICE, T.DURATION, T.TOUR_DATE
	    FROM PAYMENTS P
	    INNER JOIN TOURS T ON P.TOUR_NO = T.TOUR_NO
	    WHERE P.MERCHANT_ID = #{merchantId}
	</select>
	<update id="updateTourDeleteYn" parameterType="int">
	    UPDATE TOURS SET DELETEYN = 'Y' WHERE TOUR_NO = #{tourNo}
	</update>
	<delete id="deleteBasketsByNo">
	    DELETE FROM BASKET
	    WHERE BASKET_NO IN
	    <foreach item="no" collection="basketNoList" open="(" separator="," close=")">
	        #{no}
	    </foreach>
	</delete>
	<delete id="deleteBasket" parameterType="map">
	    DELETE FROM BASKET
	    WHERE BASKET_NO = #{basketNo}
	</delete>
	
</mapper> 