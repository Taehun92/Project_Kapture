<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.kapture.admin.mapper.AdminMapper">
	
 <!-- üìÖ ÏõîÎ≥Ñ Îß§Ï∂ú -->
    <select id="getMonthChartByYear" parameterType="hashmap" resultType="map">
        SELECT 
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '01', AMOUNT)), 0) AS "01Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '02', AMOUNT)), 0) AS "02Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '03', AMOUNT)), 0) AS "03Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '04', AMOUNT)), 0) AS "04Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '05', AMOUNT)), 0) AS "05Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '06', AMOUNT)), 0) AS "06Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '07', AMOUNT)), 0) AS "07Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '08', AMOUNT)), 0) AS "08Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '09', AMOUNT)), 0) AS "09Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '10', AMOUNT)), 0) AS "10Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '11', AMOUNT)), 0) AS "11Ïõî",
            NVL(SUM(DECODE(TO_CHAR(PAYMENT_DATE, 'MM'), '12', AMOUNT)), 0) AS "12Ïõî"
        FROM PAYMENTS
        WHERE TO_CHAR(PAYMENT_DATE, 'YYYY') = #{year}
    </select>

    <!-- üìä Ïπ¥ÌÖåÍ≥†Î¶¨ + ÏãúÍ∞ÑÎåÄÎ≥Ñ Îß§Ï∂ú -->
    <select id="getCategoryByDurationChart" parameterType="string" resultType="hashmap">
        SELECT 
            TITLE AS CATEGORY,
            DURATION AS DURATION,
            SUM(P.AMOUNT) AS TOTAL
        FROM TOURS T
        INNER JOIN PAYMENTS P ON T.TOUR_NO = P.TOUR_NO
        WHERE TO_CHAR(PAYMENT_DATE, 'YYYY') = #{year}
        GROUP BY TITLE, DURATION
        ORDER BY TITLE, DURATION
    </select>
    
    <select id="getDayChartByYearMonth" parameterType="map" resultType="map">
    SELECT TO_CHAR(PAYMENT_DATE, 'DD') || 'Ïùº' AS DAY,
           SUM(AMOUNT) AS TOTAL
    FROM PAYMENTS
    WHERE TO_CHAR(PAYMENT_DATE, 'YYYY') = #{year}
      AND TO_CHAR(PAYMENT_DATE, 'MM') = #{month}
    GROUP BY TO_CHAR(PAYMENT_DATE, 'DD')
    ORDER BY DAY
	</select>
	
	<!-- Ï¥ù Í±∞Îûò Í∏àÏï° -->
    <select id="selectTotalAmount" resultType="int">
        SELECT NVL(SUM(p.AMOUNT), 0)
        FROM PAYMENTS p
        INNER JOIN TOURS t ON p.TOUR_NO = t.TOUR_NO
        WHERE p.PAYMENT_STATUS = 'ÏäπÏù∏'
    </select>

    <!-- Ïñ¥Ï†ú Í±∞Îûò Í∏àÏï° -->
    <select id="selectYesterdayAmount" resultType="int">
        SELECT NVL(SUM(p.AMOUNT), 0)
        FROM PAYMENTS p
        INNER JOIN TOURS t ON p.TOUR_NO = t.TOUR_NO
        WHERE p.PAYMENT_STATUS = 'ÏäπÏù∏'
        AND TO_CHAR(p.PAYMENT_DATE, 'YYYYMMDD') = TO_CHAR(SYSDATE - 1, 'YYYYMMDD')
    </select>

    <!-- Ï¥ù Ïù¥Ïö© Ïù∏Ïõê -->
    <select id="selectTotalUsers" resultType="int">
        SELECT NVL(SUM(p.NUM_PEOPLE), 0)
        FROM PAYMENTS p
        INNER JOIN TOURS t ON p.TOUR_NO = t.TOUR_NO
        WHERE p.PAYMENT_STATUS = 'ÏäπÏù∏'
    </select>

    <!-- ÏäπÏù∏Îêú Í±¥Ïàò -->
    <select id="selectApprovedCount" resultType="int">
        SELECT COUNT(*)
        FROM PAYMENTS p
        INNER JOIN TOURS t ON p.TOUR_NO = t.TOUR_NO
        WHERE p.PAYMENT_STATUS = 'ÏäπÏù∏'
    </select>

    <!-- Ï∑®ÏÜåÎêú Í±¥Ïàò -->
    <select id="selectRejectedCount" resultType="int">
        SELECT COUNT(*)
        FROM PAYMENTS p
        INNER JOIN TOURS t ON p.TOUR_NO = t.TOUR_NO
        WHERE p.PAYMENT_STATUS = 'Ï∑®ÏÜå'
    </select>

	
</mapper>